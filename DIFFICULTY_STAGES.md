# 难度阶段配置说明

## 概述
游戏共有**7个难度阶段**，每个阶段持续20秒。每个阶段都有独立的敌人刷新频率和敌人类型权重配置。

## 阶段配置详情

### Stage 1 - Easy (0-20秒)
- **刷新间隔**: 90帧 (1.5秒)
- **敌人分布**: 
  - 圆形: 80%
  - 三角: 20%
  - 方块: 0%
- **特点**: 入门阶段，只有基础敌人，方块坦克尚未出现

### Stage 2 - Normal (20-40秒)
- **刷新间隔**: 75帧 (1.25秒)
- **敌人分布**:
  - 圆形: 70%
  - 三角: 25%
  - 方块: 5%
- **特点**: 方块坦克首次登场，但出现概率很低

### Stage 3 - Getting Hard (40-60秒)
- **刷新间隔**: 60帧 (1.0秒)
- **敌人分布**:
  - 圆形: 60%
  - 三角: 30%
  - 方块: 10%
- **特点**: 刷新速度显著提升，方块坦克出现频率增加

### Stage 4 - Hard (60-80秒)
- **刷新间隔**: 50帧 (0.83秒)
- **敌人分布**:
  - 圆形: 50%
  - 三角: 30%
  - 方块: 20%
- **特点**: 三种敌人趋于平衡，方块坦克成为常见威胁

### Stage 5 - Very Hard (80-100秒)
- **刷新间隔**: 40帧 (0.67秒)
- **敌人分布**:
  - 圆形: 40%
  - 三角: 35%
  - 方块: 25%
- **特点**: 高速刷新，方块坦克比例进一步提高

### Stage 6 - Extreme (100-120秒)
- **刷新间隔**: 35帧 (0.58秒)
- **敌人分布**:
  - 圆形: 30%
  - 三角: 40%
  - 方块: 30%
- **特点**: 快速敏捷的三角敌人成为主力

### Stage 7 - HELL (120秒后)
- **刷新间隔**: 30帧 (0.5秒)
- **敌人分布**:
  - 圆形: 20%
  - 三角: 40%
  - 方块: 40%
- **特点**: 最高难度，方块坦克和三角敌人占据主导

## 配置文件位置
所有阶段配置位于 `config.json` 的 `difficulty.stages` 数组中。

## 自定义配置

### 修改阶段时长
在 `config.json` 中修改：
```json
"difficulty": {
    "level_up_interval_seconds": 20  // 每个阶段持续秒数
}
```

### 修改单个阶段配置
在 `config.json` 的 `stages` 数组中找到对应阶段，修改：
```json
{
    "level": 3,
    "name": "Stage 4 - Hard",
    "spawn_delay": 50,           // 刷新间隔（帧数，60帧=1秒）
    "circle_weight": 0.5,        // 圆形敌人权重 (0-1)
    "triangle_weight": 0.3,      // 三角敌人权重 (0-1)
    "square_weight": 0.2         // 方块敌人权重 (0-1)
}
```

**注意**: 三个权重之和应该等于1.0

### 添加新阶段
1. 在 `stages` 数组末尾添加新配置
2. 更新 `max_level` 为新的最高等级（level从0开始）
3. 设置新阶段的 `name`, `spawn_delay` 和三种敌人权重

例如添加第8阶段：
```json
{
    "level": 7,
    "name": "Stage 8 - Impossible",
    "spawn_delay": 25,
    "circle_weight": 0.1,
    "triangle_weight": 0.4,
    "square_weight": 0.5
}
```
同时将 `max_level` 改为 `7`。

## 敌人类型特点

### 圆形敌人 (Circle)
- 血量: 30
- 速度: 慢 (1.0)
- 射击频率: 低
- 子弹伤害: 1
- 分数: 10

### 三角敌人 (Triangle)
- 血量: 20
- 速度: 快 (3.0)
- 射击频率: 高
- 子弹伤害: 1
- 分数: 20

### 方块敌人 (Square)
- 血量: 100
- 速度: 慢 (1.0)
- 射击频率: 低
- 子弹伤害: **2** (高伤害，子弹更大更显眼)
- 分数: 50

## 视觉特效

### 难度提升提示
- 屏幕边框闪烁红色警告
- 显示新阶段名称（如 "Stage 4 - Hard"）
- 播放警告音效
- 持续1秒（60帧）

### 高伤害子弹
方块敌人的子弹具有特殊视觉效果：
- 尺寸更大（18x18像素，普通子弹12x12）
- 橙黄色多层光晕
- 明亮的白热核心
- 更易识别和躲避

## 游戏平衡建议

1. **前期（Stage 1-2）**: 适应游戏机制，积累能量
2. **中期（Stage 3-4）**: 开始合理使用强化状态，注意方块坦克
3. **后期（Stage 5-7）**: 需要精确走位和及时使用强化，优先击杀三角和方块敌人

## 调整建议

### 降低难度
- 增加 `spawn_delay` 值（降低刷新速度）
- 减少 `square_weight` 和 `triangle_weight`
- 增加 `level_up_interval_seconds`（延长每阶段时间）

### 提高难度
- 减少 `spawn_delay` 值（提高刷新速度）
- 增加 `square_weight`（更多高伤害敌人）
- 减少 `level_up_interval_seconds`（更快进入高难度）
- 调整 `enemy_square.bullet_damage` 为更高值

## 技术说明

### 权重计算方式
游戏使用累积权重选择敌人类型：
```
random_value = random(0, 1)
if random_value < circle_weight:
    spawn Circle
elif random_value < circle_weight + triangle_weight:
    spawn Triangle
else:
    spawn Square
```

### 帧率换算
游戏运行在60FPS：
- 60帧 = 1秒
- 30帧 = 0.5秒
- 90帧 = 1.5秒

### 阶段切换
每隔 `level_up_interval_seconds` 秒，游戏会：
1. 检查是否达到最大等级
2. 如果未达到，`difficulty_level` +1
3. 从 `stages` 数组中读取新阶段配置
4. 更新 `enemy_spawn_delay` 和敌人权重
5. 触发视觉警告效果
